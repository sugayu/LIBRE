<script type="text/javascript">
  function clipboardCopy() {
    var textarea = document.createElement("textarea");
    var SelStr = document.getSelection();
    textarea.value = SelStr;
    document.body.appendChild(textarea);
    textarea.select();
    document.execCommand("copy");
    alert("「" + textarea.value + "」のコピーが完了しました！");
    textarea.parentElement.removeChild(textarea);
  }

  function dictionary_url_create(obj) {
    var SelStr = document.getSelection();
    //辞書URL作成
    obj.href = obj.href + SelStr + "/m0u/";
  }

  //辞書URL初期化
  function dictionary_init_url(obj) {
    obj.href = "https://dictionary.goo.ne.jp/srch/all/";
  }

  //マイワードに追加
  function add_mywords(){
    var SelStr = document.getSelection();
    console.log("/books/"+ gon.book_id  +"/mywords");

    console.log(String(SelStr));

    $.ajax({
      url: "/mywords/create",
      type: "GET",
      data: {selected : String(SelStr), book_id : gon.book_id},
      datatype: "html",
      success: function(data){
        //成功時の処理
        alert("「" + String(SelStr) + "」をマイワードに追加しました");
      },
      error: function(data){
        //失敗時の処理
        alert("マイワードに追加できませんでした");
      }
    });
  }

  //ページが表示されたときに呼ばれているjacvascript
  (function(){
    //// 右クリックのメニューを変更するためのjavascript
    //無効化した右クリックのイベントをここで上書きして表示できるようにしている
    document.body.addEventListener('contextmenu',function(e){//eは右クリックした時の位置情報をとっている
      var SelStr = document.getSelection();//文字列を取得

      //選択した文字列があるかどうかでclassにshowを追加するmycontextMenuを変えている
      if ( String(SelStr).length == 0 ) {
        //getElementByIdは、任意のHTMLタグで指定したIDにマッチするドキュメント要素を取得するメソッド
        var myContextMenu = document.getElementById('unselected');

        //文字列があるときに右クリック→文字列を選択しないで右クリックしても文字列があるときの右クリックメニューを削除して両方のメニューが同時に出ないようにしている
        var myContextMenu_selected = document.getElementById('selected');
        myContextMenu_selected.classList.remove('show');
      }else{
        var myContextMenu = document.getElementById('selected');
        
        //選択している文字列がないときに右クリック→右クリックしても文字列がないときの右クリックメニューを削除して両方のメニューが同時に出ないようにしている
        var myContextMenu_unselected = document.getElementById('unselected');
        myContextMenu_unselected.classList.remove('show');
      }
      var posX = e.pageX;
      var posY = e.pageY;

      myContextMenu.style.left = posX+'px';
      myContextMenu.style.top = posY+'px';
      myContextMenu.classList.add('show');

    });

    //左クリックを押したときに右クリックメニューが消えるようにしている
    document.body.addEventListener('click',function(){

      var myContextMenu_unselected = document.getElementById('unselected');
      var myContextMenu_selected = document.getElementById('selected');
      // //文字列が選択されていない時の右クリックメニューの非表示
      myContextMenu_unselected.classList.remove('show');
      // //文字列が選択されている時の右クリックメニューの非表示
      myContextMenu_selected.classList.remove('show');
    })

  }());
</script>